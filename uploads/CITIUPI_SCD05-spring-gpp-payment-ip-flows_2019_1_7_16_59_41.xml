<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:util="http://www.springframework.org/schema/util" xmlns:jaxws="http://cxf.apache.org/jaxws"
	xmlns:jee="http://www.springframework.org/schema/jee" xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-4.2.xsd
        http://www.springframework.org/schema/util
		http://www.springframework.org/schema/util/spring-util-4.2.xsd
	    http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/jee
		http://www.springframework.org/schema/jee/spring-jee-4.2.xsd         
		http://cxf.apache.org/jaxws
		http://cxf.apache.org/schemas/jaxws.xsd>
		http://www.springframework.org/schema/util
		http://www.springframework.org/schema/beans/spring-beans-4.2.xsd
		http://www.springframework.org/schema/aop 
		http://www.springframework.org/schema/aop/spring-aop-4.2.xsd
		http://www.springframework.org/schema/context
		http://www.springframework.org/schema/context/spring-context-4.2.xsd ">


	<bean id="InwardImmediatePaymentsFlow"
		class="backend.paymentprocess.flow.core.coordinator.ip.InwardImmediatePaymentsFlow"
		lazy-init="true">
		<property name="flowName" value="Inward Immediate Payments"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="paymentInitiationIPSubFlow" />
				<ref bean="partyProcessingSRCFlowStep" />				
				<ref bean="mappingAndFormattingSubFlowIP" />
				<ref bean="creditCustomerPopulationSubFlowIP" />
				<ref bean="debitCurrencyConversionFlowStep" />
				<ref bean="stopFlagsFlowStepIP" />
				<ref bean="preventSTPIPSubFlow" />
				<ref bean="advisingAndNotificationFlowStepIP" />
				<ref bean="mopSelectionFlowStep" />
				<ref bean="creditCurrencyConversionFlowStep" />
				<ref bean="debitTransactionCodeFlowStep" />
				<ref bean="creditTransactionCodeFlowStep" />
				<ref bean="feesCalculationFlowStep" />
				<ref bean="complianceCheckFlowStepHV" />
				<ref bean="checkSettlementNotificationStep" />
				<ref bean="checkSettlementNotificationAfterFirstLegStep" /><!-- we get here after posting response. when SN received before posting we arrive at InwardClearingAckImmediatePaymentsFlow -->
				<ref bean="afterAckPostingFlowStep" />
			</util:list>
		</property>
	</bean>
	
	<bean id="BasicInwardImmediatePaymentsFlow"
		class="backend.paymentprocess.flow.core.coordinator.ip.InwardImmediatePaymentsFlow"
		lazy-init="true">
		<property name="flowName" value="Basic Inward Immediate Payments"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="paymentInitiationIPSubFlow" />
				<ref bean="mappingAndFormattingSubFlowIP" />
				<ref bean="partyProcessingSRCFlowStep" />
				<ref bean="debitTransactionCodeFlowStep" /> 
				<ref bean="creditTransactionCodeFlowStep" />
				<ref bean="complianceCheckFlowStepIP" />		
			    <ref bean="BasicInwardImmediatePaymentsCDBSubFlow" />
			    <ref bean="stopFlagsFlowStepIP" />  
				<ref bean="preventSTPIPSubFlow" />	
				<ref bean="advisingAndNotificationFlowStepIP" />												
              	<ref bean="BasicInwardImmediatePaymentsSubFlow" />
				<ref bean="complianceCheckFlowStepIP" />	
                <ref bean="checkClearingAbortNotificationStep" />
				<ref bean="CheckSettlementNotificationStepIP" />
				<ref bean="afterAckPostingFlowStep" />
				<ref bean="checkClearingAbortNotificationStep" />
				<!--<ref bean="debitTransactionCodeFlowStep" />-->	
				<!--<ref bean="creditTransactionCodeFlowStep" />-->	
			</util:list>
		</property>
	</bean>
	
	<bean id="BasicInwardImmediatePaymentsCDBSubFlow" class="backend.paymentprocess.flow.core.coordinator.ip.InwardImmediatePaymentsCDBSubFlow"  
		lazy-init="true" scope="prototype">
		<property name="flowName" value="Basic Inward Immediate Payments Sub Flow to support two sanction exit points"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="creditCustomerPopulationSubFlowIP" />		
			</util:list>
		</property>
	</bean> 
	
	<bean id="BasicInwardImmediatePaymentsSubFlow" class="backend.paymentprocess.flow.core.coordinator.ip.InwardImmediatePaymentsSubFlow"  
		lazy-init="true" scope="prototype">
		<property name="flowName" value="Basic Inward Immediate Payments Sub Flow to support two sanction exit points"></property>
		<property name="flowSteps">
			<util:list>					
				<ref bean="mopSelectionFlowStep" />				
                <ref bean="checkClearingAbortNotificationStep" />
				<ref bean="debitCurrencyConversionFlowStep" />
				<ref bean="creditCurrencyConversionFlowStep" />
				<ref bean="feesCalculationFlowStep" />
                <ref bean="stopFlagsFlowStepIP" />  
			</util:list>
		</property>
	</bean> 
	
	
	<bean id="IntermmediateInwardImmediatePaymentsFlow"
		class="backend.paymentprocess.flow.core.coordinator.ip.CheckResponsesImmediatePaymentsFlow"
		lazy-init="true">
		<property name="flowName" value="Intermmediate Inward Immediate Payments"></property>
		<property name="flowSteps">
			<util:list>
                <ref bean="checkClearingAbortNotificationStep" /> 
			    <ref bean="checkCompliancResponseStep" />
				<ref bean="BasicInwardImmediatePaymentsCDBSubFlow" />
				<ref bean="stopFlagsFlowStepIP" />  
				<ref bean="preventSTPIPSubFlow" />	
				<ref bean="advisingAndNotificationFlowStepIP" />		
			    <ref bean="BasicInwardImmediatePaymentsSubFlow" />
			    <ref bean="CheckSettlementNotificationStepIP" />
				<ref bean="afterAckPostingFlowStep" />
			</util:list>
		</property>
	</bean>

	<bean id="ROFInwardImmediatePaymentsFlow"
		class="backend.paymentprocess.flow.core.coordinator.ip.InwardImmediatePaymentsFlow"
		lazy-init="true">
		<property name="flowName" value="ROF Inward Immediate Payments"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="paymentInitiationIPSubFlow" />
				<ref bean="returnOfFundsMatchingFlowStep" />
				<ref bean="mappingAndFormattingSubFlowIP" />											
				<ref bean="partyProcessingSRCFlowStep" />	
				<ref bean="creditCustomerPopulationSubFlowIP" />		
				<ref bean="preventSTPIPSubFlow" />						
				<ref bean="mopSelectionFlowStep" />				
                <ref bean="checkClearingAbortNotificationStep" />
				<ref bean="debitCurrencyConversionFlowStep" />
				<ref bean="creditCurrencyConversionFlowStep" />
				<ref bean="debitTransactionCodeFlowStep" />
				<ref bean="creditTransactionCodeFlowStep" />				
				<ref bean="feesCalculationFlowStep" />
                <ref bean="stopFlagsFlowStepIP" />                  
				<ref bean="complianceCheckFlowStepHV" />	
                <ref bean="checkClearingAbortNotificationStep" />
				<ref bean="checkSettlementNotificationStep" />
				<ref bean="afterAckPostingFlowStep" />
			</util:list>
		</property>
	</bean>

	<bean id="IncomingIpServiceMessagesFlow"
		class="backend.paymentprocess.flow.core.coordinator.ip.InwardImmediatePaymentsFlow"
		lazy-init="true">
		<property name="flowName" value="Incoming Ip Service Messages"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="paymentInitiationRFPRSubFlow" />	
				<ref bean="mappingAndMatchingFlowStep" />			
				<ref bean="mopSelectionFlowStep" />	
				<ref bean="validationRuleFlowStep" />
				<ref bean="destinationMOPSTPValidationFlowStep" />
				<ref bean="debitTransactionCodeFlowStep" />
				<ref bean="creditTransactionCodeFlowStep" />
				<ref bean="complianceCheckFlowStepHV" />
				<ref bean="OFACHitFlowStep"/>			
				<ref bean="checkRemitanceNotificationsFlowStep" />	
			</util:list>
		</property>
	</bean>
	
	<bean id="IncomingRequestforReturnFunds"
		class="backend.paymentprocess.flow.core.coordinator.ip.InwardReturnFundsFlow"
		lazy-init="true">
		<property name="flowName" value="Incoming Request for Return Funds"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="paymentInitiationRFPRSubFlow" />	
				<ref bean="paymentClassificationFlowStep" />
				<!-- < ref bean="partyDetailsEnrichmentFlowStep" />-->
				<ref bean="mappingAndMatchingFlowStep" />
				<ref bean="cancellationRequestValidationFlowStep" />
				<ref bean="preventSTPIPSubFlow" />
				<ref bean="complianceCheckFlowStepHV" />
				<ref bean="OFACHitFlowStep"/>
				<ref bean="checkSettlementNotificationStep" />									
			</util:list>
		</property>
	</bean>
	
	<bean id="IncomingRequestforPayment"
		class="backend.paymentprocess.flow.core.coordinator.ip.InwardImmediatePaymentsFlow"
		lazy-init="true">
		<property name="flowName" value="Incoming Request for Payment"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="paymentInitiationIPSubFlow" />
				<ref bean="partyProcessingDDFlowStep" />
				<ref bean="mappingAndFormattingSubFlowIP" />											
				<ref bean="creditCustomerPopulationDDSubFlowIP" />
				<ref bean="mopSelectionFlowStep" />
			<!--	<ref bean="destinationMOPSTPValidationFlowStep" />-->
				<ref bean="stopFlagsFlowStepIP" />
				<ref bean="debitTransactionCodeFlowStep" />
				<ref bean="creditTransactionCodeFlowStep" />
				<ref bean="preventSTPIPSubFlow" />
				<ref bean="complianceCheckFlowStepHV" />
				<ref bean="OFACHitFlowStep"/>
				<ref bean="checkRemitanceNotificationsFlowStep" />
			</util:list>
		</property>
	</bean>

	<bean id="IntermmediateInwardIncomingRequestforPaymentFlow"
		class="backend.paymentprocess.flow.core.coordinator.ip.CheckResponsesImmediatePaymentsFlow"
		lazy-init="true">
		<property name="flowName" value="Intermmediate Inward Immediate Payments"></property>
		<property name="flowSteps">
			<util:list>
			    <ref bean="checkCompliancResponseStep" />
			    <ref bean="OFACHitFlowStep"/> 
			    <ref bean="checkSettlementNotificationStep" />
			</util:list>
		</property>
	</bean>
	<bean id="IntermediateInwardIpServiceMessagesFlow"
		class="backend.paymentprocess.flow.core.coordinator.ip.CheckResponsesImmediatePaymentsFlow"
		lazy-init="true">
		<property name="flowName" value="Intermediate Inward Ip Service Messages"></property>
		<property name="flowSteps">
			<util:list>
			    <ref bean="checkCompliancResponseStep" />
			    <ref bean="OFACHitFlowStep"/> 
			    <ref bean="checkRemitanceNotificationsFlowStep" />
			</util:list>
		</property>
	</bean>	
	 <bean id="ipDebitCustomerPopulationSubFlow"
		class="backend.paymentprocess.flow.core.coordinator.GPPFlow"
		lazy-init="true" scope="prototype">
		<property name="flowName" value="IP Debit Customer Population"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="findFirstInDebitChainFlowStep" />
				<ref bean="loadDebitCustomerFlowStep" />
				<ref bean="debitAccountDerivationFlowStep" />
  				<!-- <ref bean="debitAuthorizationFlowStep" />-->
			</util:list>
		</property>
	</bean>


	<bean id="FinalInwardImmediatePaymentsFlow"
		class="backend.paymentprocess.flow.core.coordinator.ip.ClearingAckImmediatePaymentsFlow"
		lazy-init="true">
		<property name="flowName" value="Final Inward Immediate Payments"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="afterAckPostingFlowStep" />
			</util:list>
		</property>
	</bean>
	

	<bean id="UsInwardImmediatePaymentsFlow"
		class="backend.paymentprocess.flow.core.coordinator.ip.InwardImmediatePaymentsFlow"
		lazy-init="true">
		<property name="flowName" value="Us Inward Immediate Payments"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="paymentInitiationIPSubFlow" />
			</util:list>
		</property>
	</bean>

	<bean id="InwardClearingAckImmediatePaymentsFlow"
		class="backend.paymentprocess.flow.core.coordinator.ip.ClearingAckImmediatePaymentsFlow"
		lazy-init="true">
		<property name="flowName" value="Inward IP settlement notification"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="afterAckPostingFlowStep" />
			</util:list>
		</property>
	</bean>
	
	<bean id="GracefulTerminationForIp"
		class="backend.paymentprocess.flow.core.coordinator.ip.TerminationFlowForIp"
		lazy-init="true">
		<property name="flowName" value="Graceful Termination Flow For IP"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="TerminationFlowStepForIP" />
			</util:list>
		</property>
	</bean>

	<bean id="ReversePostingImmediatePaymentsFlow"
		class="backend.paymentprocess.flow.core.coordinator.ip.ReversePostingImmediatePaymentsFlow"
		lazy-init="true">
		<property name="flowName" value="IP reverse posting"></property>
		<property name="flowSteps">
			<util:list>
			    <ref bean="prepareReversePostingFlowStep" />
				<ref bean="postingFlowStep" />
				<ref bean="manualPostingStepIP" />
			</util:list>
		</property>
	</bean>


    <bean id="creditCustomerPopulationSubFlowIP"
              class="backend.paymentprocess.flow.core.coordinator.GPPFlow"
              lazy-init="true" scope="prototype">
              <property name="flowName" value="IP Credit Customer Population"></property>
              <property name="flowSteps">
                     <util:list>
                           <ref bean="findFirstInCreditChainFlowStep" />
                           <ref bean="loadCreditCustomerFlowStep" />
                           <ref bean="creditAccountDerivationFlowStep" />
                     </util:list>
              </property>
   </bean>
   
   
   <bean id="creditCustomerPopulationDDSubFlowIP"
              class="backend.paymentprocess.flow.core.coordinator.GPPFlow"
              lazy-init="true" scope="prototype">
              <property name="flowName" value="IP Credit Customer Population For Direct Debit"></property>
              <property name="flowSteps">
                     <util:list>
                           <ref bean="findFirstInCreditChainFlowStep" />
                           <ref bean="loadCreditCustomerFlowStep" />
                           <ref bean="creditAccountDerivationDDFlowStep" />
                     </util:list>
              </property>
   </bean>



	<bean id="paymentInitiationIPSubFlow" class="backend.paymentprocess.flow.core.coordinator.GPPFlow"
		lazy-init="true" scope="prototype">
		<property name="flowName" value="Payment Initiation (IP)"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="mapPaymentInfoIPSubFlow" />
				<ref bean="baseCurrencyConversionFlowStep" />
				<ref bean="sourceMOPSTPValidationFlowStep" />
				<ref bean="enrichAndRepairFlowStep" />
				<ref bean="stpValidationFlowStep" />
				<ref bean="duplicateCheckFlowStep" />
				<ref bean="fraudValidationFlowStep" />
				<ref bean="responseMatchingCheckFlowStepIP" />
				<ref bean="immediatePaymentReturnFlowStep" />
			</util:list>
		</property>
	</bean>
	<bean id="paymentInitiationRFPRSubFlow" class="backend.paymentprocess.flow.core.coordinator.GPPFlow"
		lazy-init="true" scope="prototype">
		<property name="flowName" value="Payment Initiation (RFPR)"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="mapPaymentInfoIPSubFlow" />
				<ref bean="enrichAndRepairFlowStep" />
				<ref bean="stpValidationFlowStep" />
				<ref bean="duplicateCheckFlowStep" />
				<ref bean="immediatePaymentReturnFlowStep" />
			</util:list>
		</property>
	</bean>

	<bean id="mapPaymentInfoIPSubFlow" class="backend.paymentprocess.flow.core.coordinator.GPPFlow"
		lazy-init="true" scope="prototype">
		<property name="flowName" value="Map Payment Info (IP)"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="departmentSelectionFlowStep" />
				<ref bean="businessAreaSelectionFlowStep" />
				<ref bean="productAreaSelectionFlowStep" />
			</util:list>
		</property>
	</bean>

	<bean id="mappingAndFormattingSubFlowIP" class="backend.paymentprocess.flow.core.coordinator.ip.MappingAndFormattingSubFlowIP" 
		lazy-init="true" scope="prototype">
		<property name="flowName" value="Map And Formatting"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="partyDetailsEnrichmentFlowStep" />
				<ref bean="baseCurrencyConversionFlowStep" />
			</util:list>
		</property>
	</bean>


	<bean id="preventSTPIPSubFlow" class="backend.paymentprocess.flow.core.coordinator.GPPFlow"
		lazy-init="true" scope="prototype">
		<property name="flowName" value="Prevent STP"></property>
		<property name="flowSteps">
			<util:list>
				<ref bean="specialInstructionsFlowStep" />
				<ref bean="validationRuleFlowStep" />
			</util:list>
		</property>
	</bean>
		
</beans>
